---
import bgHeader from '../bgHeader.webp';

const solutions = [
  { name: "Sıhhi Tesisat Çözümleri", href: "/sihhi-tesisat" },
  { name: "Kombi Bakım ve Arıza Çözümleri", href: "/kombi-bakim-ve-ariza-cozumleri" },
  { name: "Petek Temizliği", href: "/petek-temizligi" },
  { name: "Tıkanıklık Açma", href: "/tikaniklik-acma" },
  { name: "Su Kaçağı Tespiti", href: "/su-kacagi-tespiti" },
  { name: "Batarya, Musluk, Klozet Tamir & Değişimi", href: "/batarya-musluk-klozet-tamir-degisimi" },
  { name: "Banyo & Mutfak Yenileme (Tadilat)", href: "/banyo-mutfak-yenileme-tadilat" },
  { name: "Diğer", href: "/iletisim" },
];

const navItems = [
  { name: "HİZMETLER", href: "#", hasDropdown: true },
  { name: "BLOG", href: "/blog" },
  { name: "SSS", href: "/sss" },
  { name: "YORUMLAR", href: "/musteri-yorumlari" },
  { name: "İLETİŞİM", href: "/iletisim" },
  { name: "HAKKIMIZDA", href: "/hakkimizda" },
];
---

<header class="sticky top-0 z-50 shadow-md relative">
  <div class="absolute inset-0 overflow-hidden header-bg-scroll" style={`background-image: linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.3)), url(${bgHeader.src}); background-position: top left; background-size: cover; background-repeat: repeat-x; filter: blur(2px); transform: translateZ(0); will-change: background-position; backface-visibility: hidden; -webkit-backface-visibility: hidden;`}></div>
  <nav class="max-w-7xl mx-auto relative z-10">
    <div class="flex items-center justify-between h-20 px-6 lg:px-8">
      <!-- Logo -->
      <div class="flex-shrink-0">
        <a href="/" class="flex items-center space-x-2 group">
          <div class="h-10 w-1 bg-[#fad000]"></div>
          <span class="logo-text text-3xl font-extrabold text-[#ffffff] tracking-tight transition-colors duration-200" style="font-family: 'Roboto Condensed', sans-serif; text-shadow: 0.5px 0.5px 1px rgba(250, 208, 0, 0.6), -0.5px -0.5px 1px rgba(250, 208, 0, 0.6), 0.5px -0.5px 1px rgba(250, 208, 0, 0.6), -0.5px 0.5px 1px rgba(250, 208, 0, 0.6);">
            renazteknik.com
          </span>
        </a>
      </div>

      <!-- Desktop Navigation -->
      <div class="hidden lg:flex lg:items-center lg:space-x-0.5">
        {navItems.map((item) => (
          item.hasDropdown ? (
            <div class="relative group">
              <a
                href={item.href}
                class="px-5 py-3 text-lg font-extrabold text-[#ffffff] hover:text-[#000000] hover:bg-[#fad000] transition-all duration-200 uppercase tracking-wider relative inline-block cursor-pointer"
                style="font-family: 'Roboto Condensed', sans-serif; text-shadow: 0.5px 0.5px 1px rgba(250, 208, 0, 0.6), -0.5px -0.5px 1px rgba(250, 208, 0, 0.6), 0.5px -0.5px 1px rgba(250, 208, 0, 0.6), -0.5px 0.5px 1px rgba(250, 208, 0, 0.6);"
              >
                {item.name}
                <span class="absolute bottom-0 left-0 w-0 h-1 bg-[#000000] group-hover:w-full transition-all duration-300"></span>
              </a>
              <!-- Dropdown Menu -->
              <div class="dropdown-menu absolute left-0 top-full w-80 bg-white shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transform -translate-y-2 group-hover:translate-y-0 transition-all duration-300 ease-out z-[60] border-t-2 border-[#fad000]">
                <div class="py-2">
                  {solutions.map((solution) => (
                    <a
                      href={solution.href}
                      class="block px-5 py-3 text-sm font-bold text-[#000000] hover:text-[#000000] hover:bg-[#fad000] transition-colors duration-200 uppercase tracking-wider"
                      style="font-family: 'Roboto Condensed', sans-serif;"
                    >
                      {solution.name}
                    </a>
                  ))}
                </div>
              </div>
            </div>
          ) : (
            <a
              href={item.href}
              class="px-5 py-3 text-lg font-extrabold text-[#ffffff] hover:text-[#000000] hover:bg-[#fad000] transition-all duration-200 uppercase tracking-wider relative group"
              style="font-family: 'Roboto Condensed', sans-serif; text-shadow: 0.5px 0.5px 1px rgba(250, 208, 0, 0.6), -0.5px -0.5px 1px rgba(250, 208, 0, 0.6), 0.5px -0.5px 1px rgba(250, 208, 0, 0.6), -0.5px 0.5px 1px rgba(250, 208, 0, 0.6);"
            >
              {item.name}
              <span class="absolute bottom-0 left-0 w-0 h-1 bg-[#000000] group-hover:w-full transition-all duration-300"></span>
            </a>
          )
        ))}
      </div>

      <!-- Mobile Menu Button -->
      <button
        id="mobile-menu-button"
        type="button"
        class="lg:hidden p-2 text-[#ffffff] hover:bg-[#fad000] focus:outline-none focus:ring-2 focus:ring-[#fad000] focus:ring-offset-2 transition-colors duration-200"
        aria-label="Toggle menu"
        style="touch-action: manipulation; -webkit-tap-highlight-color: transparent; user-select: none; -webkit-user-select: none;"
      >
        <svg
          class="h-7 w-7"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
          stroke-width="2.5"
          style="filter: drop-shadow(0.5px 0.5px 0.5px rgba(250, 208, 0, 0.6)) drop-shadow(-0.5px -0.5px 0.5px rgba(250, 208, 0, 0.6)) drop-shadow(0.5px -0.5px 0.5px rgba(250, 208, 0, 0.6)) drop-shadow(-0.5px 0.5px 0.5px rgba(250, 208, 0, 0.6));"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M4 6h16M4 12h16M4 18h16"
          />
        </svg>
      </button>
    </div>

    <!-- Mobile Navigation -->
    <div
      id="mobile-menu"
      class="mobile-dropdown hidden lg:hidden bg-white border-t border-[#b7b7b7]"
    >
      <div class="px-4 py-4 space-y-1">
        {navItems.map((item) => (
          item.hasDropdown ? (
            <div>
              <div class="block px-4 py-3 text-lg font-extrabold text-[#000000] uppercase tracking-wider"
                style="font-family: 'Roboto Condensed', sans-serif;"
              >
                {item.name}
              </div>
              <div class="pl-4 space-y-1">
                {solutions.map((solution) => (
                  <a
                    href={solution.href}
                    class="block px-4 py-2 text-lg font-extrabold text-[#000000] hover:text-[#000000] hover:bg-[#fad000] transition-colors duration-200 uppercase tracking-wider"
                    style="font-family: 'Roboto Condensed', sans-serif;"
                  >
                    {solution.name}
                  </a>
                ))}
              </div>
            </div>
          ) : (
            <a
              href={item.href}
              class="block px-4 py-3 text-lg font-extrabold text-[#000000] hover:text-[#000000] hover:bg-[#fad000] transition-colors duration-200 uppercase tracking-wider"
              style="font-family: 'Roboto Condensed', sans-serif;"
            >
              {item.name}
            </a>
          )
        ))}
      </div>
    </div>
  </nav>
  
  <!-- Bottom Border - Positioned at absolute bottom of header, below dropdown -->
  <div class="absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-[#fad000] via-[#fad000] to-transparent" style="z-index: 1;"></div>
</header>

<style>
  /* Header background horizontal scroll animation */
  @keyframes scrollHeaderBg {
    0% {
      background-position-x: 0;
    }
    100% {
      background-position-x: -100vw;
    }
  }
  
  .header-bg-scroll {
    animation: scrollHeaderBg 30s linear infinite;
    background-position-y: top !important;
  }
  
  /* Logo flickering effect */
  .logo-text {
    position: relative;
    padding: 0.25rem 0.5rem;
    border: 2px solid transparent;
    border-radius: 4px;
  }
  
  /* Flickering animation - flickers a few times then stays on */
  @keyframes flicker {
    0% {
      border-color: transparent;
      border-width: 2px;
      box-shadow: none;
    }
    20% {
      border-color: #fad000;
      border-width: 3px;
      box-shadow: 0 0 10px rgba(250, 208, 0, 0.6),
                  0 0 20px rgba(250, 208, 0, 0.4),
                  0 0 30px rgba(250, 208, 0, 0.2);
    }
    40% {
      border-color: transparent;
      border-width: 2px;
      box-shadow: none;
    }
    60% {
      border-color: #fad000;
      border-width: 3px;
      box-shadow: 0 0 15px rgba(250, 208, 0, 0.8),
                  0 0 25px rgba(250, 208, 0, 0.6),
                  0 0 35px rgba(250, 208, 0, 0.4);
    }
    80% {
      border-color: transparent;
      border-width: 2px;
      box-shadow: none;
    }
    100% {
      border-color: #fad000;
      border-width: 3px;
      box-shadow: 0 0 10px rgba(250, 208, 0, 0.6),
                  0 0 20px rgba(250, 208, 0, 0.4),
                  0 0 30px rgba(250, 208, 0, 0.2);
    }
  }
  
  .logo-text.flickering {
    animation: flicker 0.5s forwards;
  }
  
  .logo-text.active {
    border-color: #fad000;
    border-width: 3px;
    box-shadow: 0 0 10px rgba(250, 208, 0, 0.6),
                0 0 20px rgba(250, 208, 0, 0.4),
                0 0 30px rgba(250, 208, 0, 0.2);
  }
  
  /* Ensure dropdown animation works smoothly */
  .dropdown-menu {
    transition: opacity 300ms ease-out, transform 300ms ease-out, visibility 300ms ease-out;
    z-index: 60 !important;
  }
  
  .group:hover .dropdown-menu {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }
  
  /* Mobile dropdown animation */
  .mobile-dropdown {
    max-height: 0;
    overflow: hidden;
    opacity: 0;
    transform: translateY(-10px);
    transition: max-height 300ms ease-out, opacity 300ms ease-out, transform 300ms ease-out;
    display: block !important;
  }
  
  .mobile-dropdown.mobile-menu-open {
    max-height: calc(100vh - 80px); /* Viewport height minus header height */
    opacity: 1;
    transform: translateY(0);
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    overscroll-behavior: contain;
  }
  
  .mobile-dropdown.hidden {
    max-height: 0;
    opacity: 0;
    transform: translateY(-10px);
    overflow: hidden;
  }
  
  /* Prevent body scroll when mobile menu is open */
  body.mobile-menu-open {
    overflow: hidden !important;
    position: fixed;
    width: 100%;
    height: 100%;
    left: 0;
    right: 0;
  }
  
  /* Prevent zoom on mobile */
  @media (max-width: 1024px) {
    header {
      -webkit-text-size-adjust: 100%;
      -ms-text-size-adjust: 100%;
    }
    
    header .absolute.inset-0 {
      transform: translateZ(0) scale(1);
      will-change: transform;
    }
  }
</style>

<script>
  // Audio setup
  let cogsAudio: HTMLAudioElement | null = null;
  let buzzingAudio: HTMLAudioElement | null = null;
  
  // Preload audio files
  function initAudio() {
    cogsAudio = new Audio('/cogs.mp3');
    cogsAudio.preload = 'auto';
    cogsAudio.volume = 0.2;
    
    buzzingAudio = new Audio('/buzzing.mp3');
    buzzingAudio.preload = 'auto';
    buzzingAudio.volume = 0.3;
    buzzingAudio.loop = true;
  }
  
  // Play cogs sound on mousedown anywhere on page
  document.addEventListener('DOMContentLoaded', () => {
    initAudio();
    
    // Play cogs sound on mousedown (desktop only)
    function isDesktop() {
      return window.matchMedia('(hover: hover) and (pointer: fine)').matches;
    }
    
    document.addEventListener('mousedown', () => {
      if (cogsAudio && isDesktop()) {
        cogsAudio.currentTime = 0;
        cogsAudio.play().catch(() => {
          // Ignore audio play errors
        });
      }
    }, { passive: true });
    
    // Logo hover effect with flickering and buzzing sound
    const logoText = document.querySelector('.logo-text');
    const logoLink = document.querySelector('a[href="/"]');
    
    if (logoLink && logoText) {
      let hasFlickered = false;
      
      logoLink.addEventListener('mouseenter', () => {
        if (!hasFlickered) {
          logoText.classList.add('flickering');
          hasFlickered = true;
          
          // After animation completes, add active class and remove flickering
          setTimeout(() => {
            logoText.classList.remove('flickering');
            logoText.classList.add('active');
          }, 500);
        } else {
          logoText.classList.add('active');
        }
        
        if (buzzingAudio) {
          buzzingAudio.currentTime = 0;
          buzzingAudio.play().catch(() => {
            // Ignore audio play errors
          });
        }
      });
      
      logoLink.addEventListener('mouseleave', () => {
        logoText.classList.remove('active');
        if (buzzingAudio) {
          buzzingAudio.pause();
          buzzingAudio.currentTime = 0;
        }
      });
    }
  });
  
  // Mobile menu toggle
  const mobileMenuButton = document.getElementById('mobile-menu-button');
  const mobileMenu = document.getElementById('mobile-menu');

  if (mobileMenuButton && mobileMenu) {
    mobileMenuButton.addEventListener('click', (e) => {
      e.preventDefault();
      e.stopPropagation();
      e.stopImmediatePropagation();
      
      // Prevent zoom
      const viewport = document.querySelector('meta[name="viewport"]');
      if (viewport) {
        viewport.setAttribute('content', 'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no');
      }
      
      // Toggle menu with animation
      const isHidden = mobileMenu.classList.contains('hidden');
      
      if (isHidden) {
        // Save current scroll position
        const scrollY = window.scrollY || window.pageYOffset || document.documentElement.scrollTop;
        const savedScrollPosition = scrollY || 0;
        
        // Scroll to top immediately to ensure menu is visible
        window.scrollTo(0, 0);
        
        mobileMenu.classList.remove('hidden');
        // Force reflow
        mobileMenu.offsetHeight;
        // Add open class for animation
        setTimeout(() => {
          mobileMenu.classList.add('mobile-menu-open');
          // Prevent body scrolling - lock at top (scroll position is 0 now)
          document.body.style.top = '0px';
          document.body.classList.add('mobile-menu-open');
          // Store scroll position in a data attribute for later restoration
          document.body.setAttribute('data-scroll-position', savedScrollPosition.toString());
        }, 10);
        
        // Toggle icon to X
        const icon = mobileMenuButton.querySelector('svg');
        if (icon) {
          icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />';
        }
      } else {
        mobileMenu.classList.remove('mobile-menu-open');
        
        // Restore body scrolling and scroll position
        const savedScrollPosition = document.body.getAttribute('data-scroll-position');
        document.body.classList.remove('mobile-menu-open');
        document.body.style.top = '';
        document.body.removeAttribute('data-scroll-position');
        
        if (savedScrollPosition) {
          window.scrollTo(0, parseInt(savedScrollPosition, 10));
        }
        
        // Wait for animation to complete before hiding
        setTimeout(() => {
          mobileMenu.classList.add('hidden');
        }, 300);
        
        // Toggle icon to hamburger
        const icon = mobileMenuButton.querySelector('svg');
        if (icon) {
          icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />';
        }
      }
      
      // Restore viewport after a short delay
      setTimeout(() => {
        if (viewport) {
          viewport.setAttribute('content', 'width=device-width, initial-scale=1.0');
        }
      }, 100);
    });
    
    // Also prevent double-tap zoom
    let lastTouchEnd = 0;
    mobileMenuButton.addEventListener('touchend', (e) => {
      const now = Date.now();
      if (now - lastTouchEnd <= 300) {
        e.preventDefault();
      }
      lastTouchEnd = now;
    }, false);
  }
</script>

