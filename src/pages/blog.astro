---
import Layout from '../layouts/Layout.astro';
import { getCollection, type CollectionEntry } from 'astro:content';
import blogDoodle from '../assets/blogDoodle.webp';

const blogPosts = await getCollection('blog');

// Sort by date, newest first
const sortedPosts = blogPosts.sort((a, b) => 
	new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime()
);
---

<Layout
	title="Blog | renazteknik.com"
	description="Renaz Teknik blog sayfası. Sıhhi tesisat, tamirat ve tadilat hakkında güncel yazılar ve ipuçları."
>
	<div class="tiled-background-wrapper relative min-h-screen py-12">
		<div 
			class="tiled-background-pattern parallax-bg" 
			style={`background-image: url('${blogDoodle.src}');`}
			aria-hidden="true"
		></div>
		<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12 relative z-10">
		<h1 class="text-4xl sm:text-5xl lg:text-6xl font-bold text-[#000000] mb-6" style="font-family: 'Roboto Condensed', sans-serif;">
			Blog
		</h1>
		<div class="h-1 w-24 bg-[#fad000] mb-8"></div>
		
		<div class="max-w-4xl mx-auto space-y-6">
			{sortedPosts.length === 0 ? (
				<div class="bg-white p-8 rounded-lg shadow-md">
					<p class="text-lg text-[#000000] leading-relaxed" style="font-family: 'Roboto Condensed', sans-serif;">
						Blog sayfamız yakında yayında olacak. Sıhhi tesisat, tamirat ve tadilat konularında faydalı içerikler paylaşacağız.
					</p>
				</div>
			) : (
				sortedPosts.map((post) => (
					<a href={`/blog/${post.slug}`} class="block bg-white p-8 rounded-lg shadow-md hover:shadow-lg transition-shadow duration-200">
						<h2 class="text-2xl font-bold text-[#000000] mb-3 hover:text-[#fad000] transition-colors duration-200" style="font-family: 'Roboto Condensed', sans-serif;">
							{post.data.title}
						</h2>
						<p class="text-gray-600 mb-4" style="font-family: 'Roboto Condensed', sans-serif;">
							{post.data.description}
						</p>
						<div class="flex items-center justify-between text-sm text-gray-500">
							<span style="font-family: 'Roboto Condensed', sans-serif;">
								{new Date(post.data.pubDate).toLocaleDateString('tr-TR', {
									year: 'numeric',
									month: 'long',
									day: 'numeric'
								})}
							</span>
							<span class="text-[#fad000] font-bold" style="font-family: 'Roboto Condensed', sans-serif;">
								Devamını Oku →
							</span>
						</div>
					</a>
				))
			)}
		</div>
	</div>
</div>
</Layout>

<style>
	.tiled-background-wrapper {
		--tile-size: 200px;
		background-color: #eeeeee;
		position: relative;
	}

	.tiled-background-pattern {
		position: absolute;
		inset: 0;
		pointer-events: none;
		z-index: 0;
		opacity: 0.2;
		background-size: 200px 200px;
		background-repeat: repeat;
		background-position: 0 0;
	}

	.tiled-background-wrapper > div:not(.tiled-background-pattern) {
		position: relative;
		z-index: 1;
	}

	.parallax-bg {
		will-change: transform;
		backface-visibility: hidden;
		-webkit-backface-visibility: hidden;
	}
</style>

<script>
	function initParallax() {
		const parallaxElements = document.querySelectorAll('.parallax-bg');
		if (parallaxElements.length === 0) return;

		function updateParallax() {
			const scrollY = window.pageYOffset || window.scrollY || document.documentElement.scrollTop;
			const scrollFactor = 0.25;

			parallaxElements.forEach((element) => {
				const htmlElement = element as HTMLElement;
				const wrapper = htmlElement.closest('.tiled-background-wrapper') as HTMLElement;
				if (!wrapper) return;

				const offsetY = scrollY * scrollFactor;
				const tileSize = 200;
				const normalizedOffset = offsetY % tileSize;
				
				htmlElement.style.backgroundPosition = `0 ${normalizedOffset}px`;
			});
		}

		let ticking = false;
		function onScroll() {
			if (!ticking) {
				window.requestAnimationFrame(() => {
					updateParallax();
					ticking = false;
				});
				ticking = true;
			}
		}

		updateParallax();
		window.addEventListener('scroll', onScroll, { passive: true });
		window.addEventListener('resize', updateParallax);

		return () => {
			window.removeEventListener('scroll', onScroll);
			window.removeEventListener('resize', updateParallax);
		};
	}

	if (document.readyState === 'loading') {
		document.addEventListener('DOMContentLoaded', initParallax);
	} else {
		initParallax();
	}
</script>

