---
import Layout from '../../layouts/Layout.astro';
import { getCollection, type CollectionEntry } from 'astro:content';
import blogDoodle from '../../assets/blogDoodle.webp';

export async function getStaticPaths() {
	const blogPosts = await getCollection('blog');
	return blogPosts.map((post) => ({
		params: { slug: post.slug },
		props: { post },
	}));
}

type Props = {
	post: CollectionEntry<'blog'>;
};

const { post } = Astro.props as Props;
const { Content } = await post.render();
---

<Layout
	title={`${post.data.title} | renazteknik.com`}
	description={post.data.description}
>
	<div class="tiled-background-wrapper relative min-h-screen py-12">
		<div 
			class="tiled-background-pattern parallax-bg" 
			style={`background-image: url('${blogDoodle.src}');`}
			aria-hidden="true"
		></div>
		<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12 relative z-10">
		<article class="bg-white rounded-lg shadow-md p-8">
			<header class="mb-8">
				<h1 class="text-3xl sm:text-4xl lg:text-5xl font-bold text-[#000000] mb-4" style="font-family: 'Roboto Condensed', sans-serif;">
					{post.data.title}
				</h1>
				<div class="h-1 w-24 bg-[#fad000] mb-6"></div>
				<div class="flex items-center space-x-4 text-sm text-gray-600">
					<span style="font-family: 'Roboto Condensed', sans-serif;">
						{new Date(post.data.pubDate).toLocaleDateString('tr-TR', {
							year: 'numeric',
							month: 'long',
							day: 'numeric'
						})}
					</span>
					<span style="font-family: 'Roboto Condensed', sans-serif;">
						{post.data.author}
					</span>
				</div>
			</header>
			
			<div class="prose prose-lg max-w-none" style="font-family: 'Roboto Condensed', sans-serif;">
				<Content />
			</div>
			
			<footer class="mt-8 pt-6 border-t border-gray-200">
				<a
					href="/blog"
					class="inline-flex items-center text-[#fad000] hover:text-[#e6c200] font-bold transition-colors duration-200"
					style="font-family: 'Roboto Condensed', sans-serif;"
				>
					← Blog'a Dön
				</a>
			</footer>
		</article>
	</div>
	</div>
</Layout>

<script type="application/ld+json" set:html={JSON.stringify({
	"@context": "https://schema.org",
	"@type": "BlogPosting",
	"headline": post.data.title,
	"description": post.data.description,
	"image": "https://renazteknik.com/og-image.jpg",
	"datePublished": post.data.pubDate,
	"dateModified": post.data.pubDate,
	"author": {
		"@type": "Organization",
		"name": "Renaz Teknik",
		"url": "https://renazteknik.com"
	},
	"publisher": {
		"@type": "Organization",
		"name": "Renaz Teknik",
		"logo": {
			"@type": "ImageObject",
			"url": "https://renazteknik.com/icon.svg"
		}
	},
	"mainEntityOfPage": {
		"@type": "WebPage",
		"@id": `https://renazteknik.com/blog/${post.slug}`
	}
}).replace(/</g, '\\u003c')} />

<style>
	.prose {
		color: #000000;
		line-height: 1.75;
	}
	
	.prose h2 {
		font-size: 1.875rem;
		font-weight: 700;
		margin-top: 2rem;
		margin-bottom: 1rem;
		color: #000000;
		font-family: 'Roboto Condensed', sans-serif;
	}
	
	.prose h3 {
		font-size: 1.5rem;
		font-weight: 700;
		margin-top: 1.5rem;
		margin-bottom: 0.75rem;
		color: #000000;
		font-family: 'Roboto Condensed', sans-serif;
	}
	
	.prose ul {
		list-style-type: disc;
		padding-left: 1.5rem;
		margin-top: 1rem;
		margin-bottom: 1rem;
	}
	
	.prose li {
		margin-top: 0.5rem;
		margin-bottom: 0.5rem;
	}
	
	.prose p {
		margin-top: 1rem;
		margin-bottom: 1rem;
	}
	
	.prose strong {
		font-weight: 700;
		color: #000000;
	}

	.tiled-background-wrapper {
		--tile-size: 200px;
		background-color: #eeeeee;
		position: relative;
	}

	.tiled-background-pattern {
		position: absolute;
		inset: 0;
		pointer-events: none;
		z-index: 0;
		opacity: 0.2;
		background-size: 200px 200px;
		background-repeat: repeat;
		background-position: 0 0;
	}

	.tiled-background-wrapper > div:not(.tiled-background-pattern) {
		position: relative;
		z-index: 1;
	}

	.parallax-bg {
		will-change: transform;
		backface-visibility: hidden;
		-webkit-backface-visibility: hidden;
	}
</style>

<script>
	function initParallax() {
		const parallaxElements = document.querySelectorAll('.parallax-bg');
		if (parallaxElements.length === 0) return;

		function updateParallax() {
			const scrollY = window.pageYOffset || window.scrollY || document.documentElement.scrollTop;
			const scrollFactor = 0.25;

			parallaxElements.forEach((element) => {
				const htmlElement = element as HTMLElement;
				const wrapper = htmlElement.closest('.tiled-background-wrapper') as HTMLElement;
				if (!wrapper) return;

				const offsetY = scrollY * scrollFactor;
				const tileSize = 200;
				const normalizedOffset = offsetY % tileSize;
				
				htmlElement.style.backgroundPosition = `0 ${normalizedOffset}px`;
			});
		}

		let ticking = false;
		function onScroll() {
			if (!ticking) {
				window.requestAnimationFrame(() => {
					updateParallax();
					ticking = false;
				});
				ticking = true;
			}
		}

		updateParallax();
		window.addEventListener('scroll', onScroll, { passive: true });
		window.addEventListener('resize', updateParallax);

		return () => {
			window.removeEventListener('scroll', onScroll);
			window.removeEventListener('resize', updateParallax);
		};
	}

	if (document.readyState === 'loading') {
		document.addEventListener('DOMContentLoaded', initParallax);
	} else {
		initParallax();
	}
</script>

